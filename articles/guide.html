<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Reading, querying and writing GWAS summary data in VCF format • gwasvcf</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reading, querying and writing GWAS summary data in VCF format">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gwasvcf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/guide.html">Reading, querying and writing GWAS summary data in VCF format</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrcieu/gwasvcf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Reading, querying and writing GWAS summary data in VCF format</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrcieu/gwasvcf/blob/master/vignettes/guide.Rmd" class="external-link"><code>vignettes/guide.Rmd</code></a></small>
      <div class="d-none name"><code>guide.Rmd</code></div>
    </div>

    
    
<p>We developed a format for storing and harmonising GWAS summary data
known as <a href="https://github.com/MRCIEU/gwas-vcf-specification" class="external-link">GWAS
VCF format</a>. This format is effective for being very fast when
querying chromosome and position ranges, handling multiallelic variants
and indels.</p>
<p>All the data in the <a href="https://gwas.mrcieu.ac.uk/" class="external-link">IEU GWAS
database</a> is available for download in the GWAS VCF format. This R
package provides fast and convenient functions for querying and creating
GWAS summary data in GWAS VCF format. The package builds on the <a href="https://bioconductor.org/packages/release/bioc/html/VariantAnnotation.html" class="external-link">VariantAnnotation</a>
Bioconductor package, which itself is based on the widely used <a href="https://bioconductor.org/packages/release/bioc/html/SummarizedExperiment.html" class="external-link">SummarizedExperiment</a>
Bioconductor package.</p>
<div class="section level2">
<h2 id="external-tools">External tools<a class="anchor" aria-label="anchor" href="#external-tools"></a>
</h2>
<p>For some VCF querying functions it is faster to optionally use <a href="https://samtools.github.io/bcftools/bcftools.html" class="external-link">bcftools</a>,
and when available the R package will use that strategy. To set a
location for the bcftools package, use</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mrcieu/gwasvcf" class="external-link">gwasvcf</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/set_bcftools.html">set_bcftools</a></span><span class="op">(</span><span class="st">'/path/to/bcftools'</span><span class="op">)</span></span></code></pre></div>
<p>Note that there is bcftools binary for Windows available, so some
querying options will be slower on Windows.</p>
<p>For LD related functions the package uses <a href="https://www.cog-genomics.org/plink/1.9" class="external-link">plink 1.90</a>. You can
specify the location of your plink installation by running</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_plink.html">set_plink</a></span><span class="op">(</span><span class="st">'/path/to/plink'</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively you can automatically use use the binaries bundled
here: <a href="https://github.com/mrcieu/genetics.binaRies" class="external-link uri">https://github.com/mrcieu/genetics.binaRies</a></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'mrcieu/genetics.binaRies'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/set_plink.html">set_plink</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/set_bcftools.html">set_bcftools</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>To unset a path:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_plink.html">set_plink</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/set_bcftools.html">set_bcftools</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>For this vignette we will use the bundled binaries in
<code>genetics.binaRies</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mrcieu/gwasvcf" class="external-link">gwasvcf</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">VariantAnnotation</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_bcftools.html">set_bcftools</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Path not provided, using binaries in the MRCIEU/genetics.binaRies package</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reading-in-everything">Reading in everything<a class="anchor" aria-label="anchor" href="#reading-in-everything"></a>
</h2>
<p>To read an entire dataset use the <code>readVcf</code> function. As
an example we’ll use the bundled data which is a small subset of the
Speliotes et al 2010 BMI GWAS.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcffile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"data.vcf.gz"</span>, package<span class="op">=</span><span class="st">"gwasvcf"</span><span class="op">)</span></span>
<span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/readVcf-methods.html" class="external-link">readVcf</a></span><span class="op">(</span><span class="va">vcffile</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "CollapsedVCF"</span></span>
<span><span class="co">#&gt; attr(,"package")</span></span>
<span><span class="co">#&gt; [1] "VariantAnnotation"</span></span></code></pre></div>
<p>Please refer to the <code>VariantAnnotation</code> package
documentation for full details about the <code>CollapsedVCF</code>
object. A brief summary follows.</p>
<p>General info about the dataset can be obtained by calling it:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcf</span></span>
<span><span class="co">#&gt; class: CollapsedVCF </span></span>
<span><span class="co">#&gt; dim: 92 1 </span></span>
<span><span class="co">#&gt; rowRanges(vcf):</span></span>
<span><span class="co">#&gt;   GRanges with 5 metadata columns: paramRangeID, REF, ALT, QUAL, FILTER</span></span>
<span><span class="co">#&gt; info(vcf):</span></span>
<span><span class="co">#&gt;   DataFrame with 1 column: AF</span></span>
<span><span class="co">#&gt; info(header(vcf)):</span></span>
<span><span class="co">#&gt;       Number Type  Description     </span></span>
<span><span class="co">#&gt;    AF A      Float Allele Frequency</span></span>
<span><span class="co">#&gt; geno(vcf):</span></span>
<span><span class="co">#&gt;   List of length 9: ES, SE, LP, AF, SS, EZ, SI, NC, ID</span></span>
<span><span class="co">#&gt; geno(header(vcf)):</span></span>
<span><span class="co">#&gt;       Number Type   Description                                                     </span></span>
<span><span class="co">#&gt;    ES A      Float  Effect size estimate relative to the alternative allele         </span></span>
<span><span class="co">#&gt;    SE A      Float  Standard error of effect size estimate                          </span></span>
<span><span class="co">#&gt;    LP A      Float  -log10 p-value for effect estimate                              </span></span>
<span><span class="co">#&gt;    AF A      Float  Alternate allele frequency in the association study             </span></span>
<span><span class="co">#&gt;    SS A      Float  Sample size used to estimate genetic effect                     </span></span>
<span><span class="co">#&gt;    EZ A      Float  Z-score provided if it was used to derive the EFFECT and SE f...</span></span>
<span><span class="co">#&gt;    SI A      Float  Accuracy score of summary data imputation                       </span></span>
<span><span class="co">#&gt;    NC A      Float  Number of cases used to estimate genetic effect                 </span></span>
<span><span class="co">#&gt;    ID 1      String Study variant identifier</span></span></code></pre></div>
<p>There are 92 rows and 1 column which means 92 SNPs and one GWAS. See
the header information:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/VCFHeader-class.html" class="external-link">header</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">)</span></span>
<span><span class="co">#&gt; class: VCFHeader </span></span>
<span><span class="co">#&gt; samples(1): IEU-a-2</span></span>
<span><span class="co">#&gt; meta(4): fileformat META SAMPLE contig</span></span>
<span><span class="co">#&gt; fixed(1): FILTER</span></span>
<span><span class="co">#&gt; info(1): AF</span></span>
<span><span class="co">#&gt; geno(9): ES SE ... NC ID</span></span></code></pre></div>
<p>See the names of the GWAS datasets (in this case just one, and it
refers to the IEU GWAS database ID name):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Biobase/man/class.MIAME.html" class="external-link">samples</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/VCFHeader-class.html" class="external-link">header</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "IEU-a-2"</span></span></code></pre></div>
<p>In this case you can obtain information about this study through the
<code>ieugwasr</code> package
e.g. <code>ieugwasr::gwasinfo("IEU-a-2")</code>.</p>
<p>There are a few components within the object:</p>
<ul>
<li>
<code>header</code> which has the meta data describing the dataset,
including the association result variables</li>
<li>
<code>rowRanges</code> which is information about each variant</li>
<li>
<code>info</code> which is further metadata about each variant</li>
<li>
<code>geno</code> which is the actual association results for each
GWAS</li>
</ul>
<p>the <code>rowRanges</code> object is a <code>GenomicRanges</code>
class, which is useful for performing fast operations on chromosome
position information.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rowRanges</span><span class="op">(</span><span class="va">vcf</span><span class="op">)</span></span>
<span><span class="co">#&gt; GRanges object with 92 ranges and 5 metadata columns:</span></span>
<span><span class="co">#&gt;              seqnames    ranges strand | paramRangeID            REF</span></span>
<span><span class="co">#&gt;                 &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; |     &lt;factor&gt; &lt;DNAStringSet&gt;</span></span>
<span><span class="co">#&gt;   rs12565286        1    721290      * |           NA              G</span></span>
<span><span class="co">#&gt;   rs11804171        1    723819      * |           NA              T</span></span>
<span><span class="co">#&gt;    rs2977670        1    723891      * |           NA              G</span></span>
<span><span class="co">#&gt;    rs3094315        1    752566      * |           NA              G</span></span>
<span><span class="co">#&gt;    rs2073813        1    753541      * |           NA              G</span></span>
<span><span class="co">#&gt;          ...      ...       ...    ... .          ...            ...</span></span>
<span><span class="co">#&gt;     rs715643        1   1172907      * |           NA              C</span></span>
<span><span class="co">#&gt;    rs6675798        1   1176597      * |           NA              T</span></span>
<span><span class="co">#&gt;    rs6603783        1   1181751      * |           NA              T</span></span>
<span><span class="co">#&gt;    rs6603785        1   1186502      * |           NA              A</span></span>
<span><span class="co">#&gt;    rs6603787        1   1188225      * |           NA              G</span></span>
<span><span class="co">#&gt;                             ALT      QUAL      FILTER</span></span>
<span><span class="co">#&gt;              &lt;DNAStringSetList&gt; &lt;numeric&gt; &lt;character&gt;</span></span>
<span><span class="co">#&gt;   rs12565286                  C        NA        PASS</span></span>
<span><span class="co">#&gt;   rs11804171                  A        NA        PASS</span></span>
<span><span class="co">#&gt;    rs2977670                  C        NA        PASS</span></span>
<span><span class="co">#&gt;    rs3094315                  A        NA        PASS</span></span>
<span><span class="co">#&gt;    rs2073813                  A        NA        PASS</span></span>
<span><span class="co">#&gt;          ...                ...       ...         ...</span></span>
<span><span class="co">#&gt;     rs715643                  T        NA        PASS</span></span>
<span><span class="co">#&gt;    rs6675798                  C        NA        PASS</span></span>
<span><span class="co">#&gt;    rs6603783                  C        NA        PASS</span></span>
<span><span class="co">#&gt;    rs6603785                  T        NA        PASS</span></span>
<span><span class="co">#&gt;    rs6603787                  T        NA        PASS</span></span>
<span><span class="co">#&gt;   -------</span></span>
<span><span class="co">#&gt;   seqinfo: 84 sequences from GRCh37 genome</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="converting-to-simple-dataframes">Converting to simple dataframes<a class="anchor" aria-label="anchor" href="#converting-to-simple-dataframes"></a>
</h2>
<p>The VCF object is somewhat complex and you can read more about it in
the <a href="https://bioconductor.org/packages/release/bioc/html/VariantAnnotation.html" class="external-link">VariantAnnotation
package documentation</a>. You can create various other formats that
might be easier to use from it. For example, create a
<code>GRanges</code> object which is great for fast chromosome-position
operations</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/vcf_to_granges.html">vcf_to_granges</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">)</span></span>
<span><span class="co">#&gt; GRanges object with 92 ranges and 15 metadata columns:</span></span>
<span><span class="co">#&gt;              seqnames    ranges strand | paramRangeID         REF         ALT</span></span>
<span><span class="co">#&gt;                 &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; |     &lt;factor&gt; &lt;character&gt; &lt;character&gt;</span></span>
<span><span class="co">#&gt;   rs12565286        1    721290      * |           NA           G           C</span></span>
<span><span class="co">#&gt;   rs11804171        1    723819      * |           NA           T           A</span></span>
<span><span class="co">#&gt;    rs2977670        1    723891      * |           NA           G           C</span></span>
<span><span class="co">#&gt;    rs3094315        1    752566      * |           NA           G           A</span></span>
<span><span class="co">#&gt;    rs2073813        1    753541      * |           NA           G           A</span></span>
<span><span class="co">#&gt;          ...      ...       ...    ... .          ...         ...         ...</span></span>
<span><span class="co">#&gt;     rs715643        1   1172907      * |           NA           C           T</span></span>
<span><span class="co">#&gt;    rs6675798        1   1176597      * |           NA           T           C</span></span>
<span><span class="co">#&gt;    rs6603783        1   1181751      * |           NA           T           C</span></span>
<span><span class="co">#&gt;    rs6603785        1   1186502      * |           NA           A           T</span></span>
<span><span class="co">#&gt;    rs6603787        1   1188225      * |           NA           G           T</span></span>
<span><span class="co">#&gt;                   QUAL      FILTER        ES        SE        LP        AF        SS</span></span>
<span><span class="co">#&gt;              &lt;numeric&gt; &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;</span></span>
<span><span class="co">#&gt;   rs12565286        NA        PASS   -0.0067    0.0145 0.1930060   0.93220  109823.0</span></span>
<span><span class="co">#&gt;   rs11804171        NA        PASS   -0.0146    0.0175 0.3935110   0.96296   84828.0</span></span>
<span><span class="co">#&gt;    rs2977670        NA        PASS    0.0044    0.0184 0.0909791   0.07143   68458.9</span></span>
<span><span class="co">#&gt;    rs3094315        NA        PASS    0.0060    0.0065 0.4485500   0.15520  131544.0</span></span>
<span><span class="co">#&gt;    rs2073813        NA        PASS    0.0035    0.0102 0.1357860        NA   64351.3</span></span>
<span><span class="co">#&gt;          ...       ...         ...       ...       ...       ...       ...       ...</span></span>
<span><span class="co">#&gt;     rs715643        NA        PASS    0.0019    0.0118 0.0594337   0.90833    121822</span></span>
<span><span class="co">#&gt;    rs6675798        NA        PASS   -0.0013    0.0067 0.0725270   0.89170    223475</span></span>
<span><span class="co">#&gt;    rs6603783        NA        PASS   -0.0002    0.0069 0.0101499   0.90000    220022</span></span>
<span><span class="co">#&gt;    rs6603785        NA        PASS    0.0075    0.0104 0.3271640   0.91667    165964</span></span>
<span><span class="co">#&gt;    rs6603787        NA        PASS    0.0025    0.0089 0.1085740        NA    199099</span></span>
<span><span class="co">#&gt;                     EZ        SI        NC          ID          id</span></span>
<span><span class="co">#&gt;              &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;character&gt; &lt;character&gt;</span></span>
<span><span class="co">#&gt;   rs12565286        NA        NA        NA  rs12565286     IEU-a-2</span></span>
<span><span class="co">#&gt;   rs11804171        NA        NA        NA  rs11804171     IEU-a-2</span></span>
<span><span class="co">#&gt;    rs2977670        NA        NA        NA   rs2977670     IEU-a-2</span></span>
<span><span class="co">#&gt;    rs3094315        NA        NA        NA   rs3094315     IEU-a-2</span></span>
<span><span class="co">#&gt;    rs2073813        NA        NA        NA   rs2073813     IEU-a-2</span></span>
<span><span class="co">#&gt;          ...       ...       ...       ...         ...         ...</span></span>
<span><span class="co">#&gt;     rs715643        NA        NA        NA    rs715643     IEU-a-2</span></span>
<span><span class="co">#&gt;    rs6675798        NA        NA        NA   rs6675798     IEU-a-2</span></span>
<span><span class="co">#&gt;    rs6603783        NA        NA        NA   rs6603783     IEU-a-2</span></span>
<span><span class="co">#&gt;    rs6603785        NA        NA        NA   rs6603785     IEU-a-2</span></span>
<span><span class="co">#&gt;    rs6603787        NA        NA        NA   rs6603787     IEU-a-2</span></span>
<span><span class="co">#&gt;   -------</span></span>
<span><span class="co">#&gt;   seqinfo: 84 sequences from GRCh37 genome</span></span></code></pre></div>
<p>Create a data frame:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/vcf_to_granges.html">vcf_to_granges</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 92 × 20</span></span>
<span><span class="co">#&gt;    seqnames  start    end width strand paramRangeID REF   ALT    QUAL FILTER      ES</span></span>
<span><span class="co">#&gt;    &lt;fct&gt;     &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;fct&gt;  &lt;fct&gt;        &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 1        721290 721290     1 *      &lt;NA&gt;         G     C        NA PASS   -0.0067</span></span>
<span><span class="co">#&gt;  2 1        723819 723819     1 *      &lt;NA&gt;         T     A        NA PASS   -0.0146</span></span>
<span><span class="co">#&gt;  3 1        723891 723891     1 *      &lt;NA&gt;         G     C        NA PASS    0.0044</span></span>
<span><span class="co">#&gt;  4 1        752566 752566     1 *      &lt;NA&gt;         G     A        NA PASS    0.006 </span></span>
<span><span class="co">#&gt;  5 1        753541 753541     1 *      &lt;NA&gt;         G     A        NA PASS    0.0035</span></span>
<span><span class="co">#&gt;  6 1        754192 754192     1 *      &lt;NA&gt;         A     G        NA PASS    0.0077</span></span>
<span><span class="co">#&gt;  7 1        768448 768448     1 *      &lt;NA&gt;         G     A        NA PASS   -0.0027</span></span>
<span><span class="co">#&gt;  8 1        775659 775659     1 *      &lt;NA&gt;         A     G        NA PASS    0.0029</span></span>
<span><span class="co">#&gt;  9 1        777122 777122     1 *      &lt;NA&gt;         A     T        NA PASS    0.0031</span></span>
<span><span class="co">#&gt; 10 1        779322 779322     1 *      &lt;NA&gt;         A     G        NA PASS   -0.0062</span></span>
<span><span class="co">#&gt; # ℹ 82 more rows</span></span>
<span><span class="co">#&gt; # ℹ 9 more variables: SE &lt;dbl&gt;, LP &lt;dbl&gt;, AF &lt;dbl&gt;, SS &lt;dbl&gt;, EZ &lt;dbl&gt;, SI &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   NC &lt;dbl&gt;, ID &lt;chr&gt;, id &lt;chr&gt;</span></span></code></pre></div>
<p>The direct conversion to formats for tools such as TwoSampleMR,
coloc, and many others can also be made using the <a href="https://github.com/mrcieu/gwasglue" class="external-link">https://github.com/mrcieu/gwasglue</a>
R package.</p>
</div>
<div class="section level2">
<h2 id="reading-in-with-filters">Reading in with filters<a class="anchor" aria-label="anchor" href="#reading-in-with-filters"></a>
</h2>
<p>The <code><a href="../reference/query_gwas.html">query_gwas()</a></code> function takes either a filename to a
vcf file, or vcf object as the main argument. You can then query on
<code>rsid</code>, <code>pval</code> or <code>chrompos</code>. For
example</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcfsubset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span><span class="op">(</span><span class="va">vcffile</span>, chrompos<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1:1097291-1099437"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/readVcf-methods.html" class="external-link">readVcf</a></span><span class="op">(</span><span class="va">vcffile</span><span class="op">)</span></span>
<span><span class="va">vcfsubset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span><span class="op">(</span><span class="va">vcf</span>, chrompos<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1:1097291-1099437"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>are each identical, but the former saves time and memory because it
is querying the file using an index and only reading in what is
required.</p>
<p>Examples of other filters are here:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span><span class="op">(</span><span class="va">vcffile</span>, rsid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rs3128126"</span>, <span class="st">"rs3121561"</span>, <span class="st">"rs3813193"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vcf</span></span>
<span><span class="co">#&gt; class: CollapsedVCF </span></span>
<span><span class="co">#&gt; dim: 3 1 </span></span>
<span><span class="co">#&gt; rowRanges(vcf):</span></span>
<span><span class="co">#&gt;   GRanges with 5 metadata columns: paramRangeID, REF, ALT, QUAL, FILTER</span></span>
<span><span class="co">#&gt; info(vcf):</span></span>
<span><span class="co">#&gt;   DataFrame with 3 columns: AF, AC, AN</span></span>
<span><span class="co">#&gt; info(header(vcf)):</span></span>
<span><span class="co">#&gt;       Number Type    Description                                </span></span>
<span><span class="co">#&gt;    AF A      Float   Allele Frequency                           </span></span>
<span><span class="co">#&gt;    AC A      Integer Allele count in genotypes                  </span></span>
<span><span class="co">#&gt;    AN 1      Integer Total number of alleles in called genotypes</span></span>
<span><span class="co">#&gt; geno(vcf):</span></span>
<span><span class="co">#&gt;   List of length 9: ES, SE, LP, AF, SS, EZ, SI, NC, ID</span></span>
<span><span class="co">#&gt; geno(header(vcf)):</span></span>
<span><span class="co">#&gt;       Number Type   Description                                                     </span></span>
<span><span class="co">#&gt;    ES A      Float  Effect size estimate relative to the alternative allele         </span></span>
<span><span class="co">#&gt;    SE A      Float  Standard error of effect size estimate                          </span></span>
<span><span class="co">#&gt;    LP A      Float  -log10 p-value for effect estimate                              </span></span>
<span><span class="co">#&gt;    AF A      Float  Alternate allele frequency in the association study             </span></span>
<span><span class="co">#&gt;    SS A      Float  Sample size used to estimate genetic effect                     </span></span>
<span><span class="co">#&gt;    EZ A      Float  Z-score provided if it was used to derive the EFFECT and SE f...</span></span>
<span><span class="co">#&gt;    SI A      Float  Accuracy score of summary data imputation                       </span></span>
<span><span class="co">#&gt;    NC A      Float  Number of cases used to estimate genetic effect                 </span></span>
<span><span class="co">#&gt;    ID 1      String Study variant identifier</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span><span class="op">(</span><span class="va">vcffile</span>, pval<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">vcf</span></span>
<span><span class="co">#&gt; class: CollapsedVCF </span></span>
<span><span class="co">#&gt; dim: 45 1 </span></span>
<span><span class="co">#&gt; rowRanges(vcf):</span></span>
<span><span class="co">#&gt;   GRanges with 5 metadata columns: paramRangeID, REF, ALT, QUAL, FILTER</span></span>
<span><span class="co">#&gt; info(vcf):</span></span>
<span><span class="co">#&gt;   DataFrame with 3 columns: AF, AC, AN</span></span>
<span><span class="co">#&gt; info(header(vcf)):</span></span>
<span><span class="co">#&gt;       Number Type    Description                                </span></span>
<span><span class="co">#&gt;    AF A      Float   Allele Frequency                           </span></span>
<span><span class="co">#&gt;    AC A      Integer Allele count in genotypes                  </span></span>
<span><span class="co">#&gt;    AN 1      Integer Total number of alleles in called genotypes</span></span>
<span><span class="co">#&gt; geno(vcf):</span></span>
<span><span class="co">#&gt;   List of length 9: ES, SE, LP, AF, SS, EZ, SI, NC, ID</span></span>
<span><span class="co">#&gt; geno(header(vcf)):</span></span>
<span><span class="co">#&gt;       Number Type   Description                                                     </span></span>
<span><span class="co">#&gt;    ES A      Float  Effect size estimate relative to the alternative allele         </span></span>
<span><span class="co">#&gt;    SE A      Float  Standard error of effect size estimate                          </span></span>
<span><span class="co">#&gt;    LP A      Float  -log10 p-value for effect estimate                              </span></span>
<span><span class="co">#&gt;    AF A      Float  Alternate allele frequency in the association study             </span></span>
<span><span class="co">#&gt;    SS A      Float  Sample size used to estimate genetic effect                     </span></span>
<span><span class="co">#&gt;    EZ A      Float  Z-score provided if it was used to derive the EFFECT and SE f...</span></span>
<span><span class="co">#&gt;    SI A      Float  Accuracy score of summary data imputation                       </span></span>
<span><span class="co">#&gt;    NC A      Float  Number of cases used to estimate genetic effect                 </span></span>
<span><span class="co">#&gt;    ID 1      String Study variant identifier</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span><span class="op">(</span><span class="va">vcffile</span>, chrompos<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1:1097291-1099437"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vcf</span></span>
<span><span class="co">#&gt; class: CollapsedVCF </span></span>
<span><span class="co">#&gt; dim: 2 1 </span></span>
<span><span class="co">#&gt; rowRanges(vcf):</span></span>
<span><span class="co">#&gt;   GRanges with 5 metadata columns: paramRangeID, REF, ALT, QUAL, FILTER</span></span>
<span><span class="co">#&gt; info(vcf):</span></span>
<span><span class="co">#&gt;   DataFrame with 3 columns: AF, AC, AN</span></span>
<span><span class="co">#&gt; info(header(vcf)):</span></span>
<span><span class="co">#&gt;       Number Type    Description                                </span></span>
<span><span class="co">#&gt;    AF A      Float   Allele Frequency                           </span></span>
<span><span class="co">#&gt;    AC A      Integer Allele count in genotypes                  </span></span>
<span><span class="co">#&gt;    AN 1      Integer Total number of alleles in called genotypes</span></span>
<span><span class="co">#&gt; geno(vcf):</span></span>
<span><span class="co">#&gt;   List of length 9: ES, SE, LP, AF, SS, EZ, SI, NC, ID</span></span>
<span><span class="co">#&gt; geno(header(vcf)):</span></span>
<span><span class="co">#&gt;       Number Type   Description                                                     </span></span>
<span><span class="co">#&gt;    ES A      Float  Effect size estimate relative to the alternative allele         </span></span>
<span><span class="co">#&gt;    SE A      Float  Standard error of effect size estimate                          </span></span>
<span><span class="co">#&gt;    LP A      Float  -log10 p-value for effect estimate                              </span></span>
<span><span class="co">#&gt;    AF A      Float  Alternate allele frequency in the association study             </span></span>
<span><span class="co">#&gt;    SS A      Float  Sample size used to estimate genetic effect                     </span></span>
<span><span class="co">#&gt;    EZ A      Float  Z-score provided if it was used to derive the EFFECT and SE f...</span></span>
<span><span class="co">#&gt;    SI A      Float  Accuracy score of summary data imputation                       </span></span>
<span><span class="co">#&gt;    NC A      Float  Number of cases used to estimate genetic effect                 </span></span>
<span><span class="co">#&gt;    ID 1      String Study variant identifier</span></span></code></pre></div>
<p>It’s possible to chain filters together e.g.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span><span class="op">(</span><span class="va">vcffile</span>, rsid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rs3128126"</span>, <span class="st">"rs3121561"</span>, <span class="st">"rs3813193"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span><span class="op">(</span>pval<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">vcf</span></span>
<span><span class="co">#&gt; class: CollapsedVCF </span></span>
<span><span class="co">#&gt; dim: 1 1 </span></span>
<span><span class="co">#&gt; rowRanges(vcf):</span></span>
<span><span class="co">#&gt;   GRanges with 5 metadata columns: paramRangeID, REF, ALT, QUAL, FILTER</span></span>
<span><span class="co">#&gt; info(vcf):</span></span>
<span><span class="co">#&gt;   DataFrame with 3 columns: AF, AC, AN</span></span>
<span><span class="co">#&gt; info(header(vcf)):</span></span>
<span><span class="co">#&gt;       Number Type    Description                                </span></span>
<span><span class="co">#&gt;    AF A      Float   Allele Frequency                           </span></span>
<span><span class="co">#&gt;    AC A      Integer Allele count in genotypes                  </span></span>
<span><span class="co">#&gt;    AN 1      Integer Total number of alleles in called genotypes</span></span>
<span><span class="co">#&gt; geno(vcf):</span></span>
<span><span class="co">#&gt;   List of length 9: ES, SE, LP, AF, SS, EZ, SI, NC, ID</span></span>
<span><span class="co">#&gt; geno(header(vcf)):</span></span>
<span><span class="co">#&gt;       Number Type   Description                                                     </span></span>
<span><span class="co">#&gt;    ES A      Float  Effect size estimate relative to the alternative allele         </span></span>
<span><span class="co">#&gt;    SE A      Float  Standard error of effect size estimate                          </span></span>
<span><span class="co">#&gt;    LP A      Float  -log10 p-value for effect estimate                              </span></span>
<span><span class="co">#&gt;    AF A      Float  Alternate allele frequency in the association study             </span></span>
<span><span class="co">#&gt;    SS A      Float  Sample size used to estimate genetic effect                     </span></span>
<span><span class="co">#&gt;    EZ A      Float  Z-score provided if it was used to derive the EFFECT and SE f...</span></span>
<span><span class="co">#&gt;    SI A      Float  Accuracy score of summary data imputation                       </span></span>
<span><span class="co">#&gt;    NC A      Float  Number of cases used to estimate genetic effect                 </span></span>
<span><span class="co">#&gt;    ID 1      String Study variant identifier</span></span></code></pre></div>
<p>It’s possible to have multiple GWAS studies per vcf. You can specify
specific GWAS studies to read in using e.g.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span><span class="op">(</span><span class="va">vcffile</span>, rsid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rs3128126"</span>, <span class="st">"rs3121561"</span>, <span class="st">"rs3813193"</span><span class="op">)</span>, id<span class="op">=</span><span class="st">"IEU-a-2"</span><span class="op">)</span></span></code></pre></div>
<p>Note that querying by chrompos is the fastest way to deal with VCFs,
use this over rsid where possible when speed is an issue.</p>
</div>
<div class="section level2">
<h2 id="indexing-rsid-values">Indexing rsid values<a class="anchor" aria-label="anchor" href="#indexing-rsid-values"></a>
</h2>
<p>Querying by rsid is slow. If a large number of queries by rsid are to
be performed then it could be worth generating an index which would
speed up the querying. This approach uses <a href="https://www.sqlite.org/index.html" class="external-link">SQLite</a> to create a local
database, linking rsid to chromosome and position. It strips out the
‘rs’ from the rs identifiers to make fast searchers by integer. The
concept is based on that developed here: <a href="https://github.com/bioforensics/rsidx" class="external-link">bioforensics/rsidx</a>.</p>
<p>To create the index:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_rsidx_index_from_vcf.html">create_rsidx_index_from_vcf</a></span><span class="op">(</span><span class="va">vcffile</span>, <span class="st">"index.rsidx"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting position info</span></span>
<span><span class="co">#&gt; Generating index</span></span></code></pre></div>
<p>To query using the index:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span><span class="op">(</span><span class="va">vcffile</span>, rsid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rs3128126"</span>, <span class="st">"rs3121561"</span>, <span class="st">"rs3813193"</span><span class="op">)</span>, rsidx<span class="op">=</span><span class="st">"index.rsidx"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="indexing-p-values">Indexing p-values<a class="anchor" aria-label="anchor" href="#indexing-p-values"></a>
</h2>
<p>Querying by p-value is slow. It could be worth generating an index
file for p-values to speed this up. Similar to rsid queries, it uses an
sqlite database linking -log10 pvalues to chromosome and position.</p>
<p>To create the index:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_pval_index_from_vcf.html">create_pval_index_from_vcf</a></span><span class="op">(</span><span class="va">vcffile</span>, maximum_pval<span class="op">=</span><span class="fl">0.05</span>, <span class="st">"index.pvali"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting pval info</span></span>
<span><span class="co">#&gt; [1] "CREATE TABLE pval_to_coord (chrom TEXT NOT NULL DEFAULT NULL, coord INTEGER NOT NULL DEFAULT NULL, LP REAL NOT NULL DEFAULT 0);"</span></span>
<span><span class="co">#&gt; [2] ".separator ,"                                                                                                                   </span></span>
<span><span class="co">#&gt; [3] ".import /var/folders/9j/bw4vdrw94yndry3z9cv8ms1m0000gn/T//RtmpFnAKs1/file22f4fdc3a4d pval_to_coord"                             </span></span>
<span><span class="co">#&gt; [4] "CREATE INDEX idx_LP ON pval_to_coord (LP)"</span></span>
<span><span class="co">#&gt; Generating index</span></span></code></pre></div>
<p>To query using the index:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span><span class="op">(</span><span class="va">vcffile</span>, pval<span class="op">=</span><span class="fl">0.05</span>, pvali<span class="op">=</span><span class="st">"index.pvali"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using pval index</span></span>
<span><span class="co">#&gt; Identified 7 variants passing threshold. Extracting...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-note-about-chrompos">A note about chrompos<a class="anchor" aria-label="anchor" href="#a-note-about-chrompos"></a>
</h2>
<p>The fastest way to query VCFs is by specifying chromosome and
position. Can specify specific positions, or ranges. e.g.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1:10000"</span>, <span class="st">"2:10000-20000"</span><span class="op">)</span></span></code></pre></div>
<p>or as a data frame</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cp</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>chrom<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10000</span>,<span class="fl">10000</span><span class="op">)</span>, end<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10000</span>, <span class="fl">20000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>You can check what will be parsed out with:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/parse_chrompos.html">parse_chrompos</a></span><span class="op">(</span><span class="va">cp</span><span class="op">)</span></span>
<span><span class="co">#&gt; GRanges object with 2 ranges and 0 metadata columns:</span></span>
<span><span class="co">#&gt;       seqnames      ranges strand</span></span>
<span><span class="co">#&gt;          &lt;Rle&gt;   &lt;IRanges&gt;  &lt;Rle&gt;</span></span>
<span><span class="co">#&gt;   [1]        1       10000      *</span></span>
<span><span class="co">#&gt;   [2]        2 10000-20000      *</span></span>
<span><span class="co">#&gt;   -------</span></span>
<span><span class="co">#&gt;   seqinfo: 2 sequences from an unspecified genome; no seqlengths</span></span></code></pre></div>
<p>Querying by p-value or rsid is also possible but is slower as only
chrompos is indexed. On Mac and Linux, rsid and p-value queries are
performed by calls to bcftools. On Windows it uses VariantAnnotation
directly, because bcftools binaries are not available. This is
unfortunately somewhat slower. If many operations are being performed it
might be faster to read in the whole dataset and perform queries that
way.</p>
</div>
<div class="section level2">
<h2 id="ld-proxies">LD proxies<a class="anchor" aria-label="anchor" href="#ld-proxies"></a>
</h2>
<p>If a set of rsids are requested from a vcf but some are absent, a
reference panel can be used to search for LD proxies, extract them, and
align the effects and alleles against the original variants that were
requested.</p>
<p>There are two ways to perform the LD proxy search:</p>
<ul>
<li>using a set of genotyped samples as an LD reference panel (e.g. 1000
genomes data) - this is slow but relatively convenient</li>
<li>compiling an LD tag list from an LD reference panel - once generated
this is very fast</li>
</ul>
<div class="section level3">
<h3 id="using-an-ld-reference-panel">Using an LD reference panel<a class="anchor" aria-label="anchor" href="#using-an-ld-reference-panel"></a>
</h3>
<p>An LD reference panel can be obtained from here: <a href="http://fileserve.mrcieu.ac.uk/ld/data_maf0.01_rs_ref.tgz" class="external-link">http://fileserve.mrcieu.ac.uk/ld/data_maf0.01_rs_ref.tgz</a>.
This dataset comprises Europeans from the 1000 genomes project, in plink
format, and including only SNPs with MAF &gt; 0.01, and with the
reference alleles aligned to the human genome reference sequence. For
this vignette we can use a small subset of that dataset:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ldfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"eur.bed"</span>, package<span class="op">=</span><span class="st">"gwasvcf"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".bed"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span></code></pre></div>
<p>We also need to provide a path to the plink binary used to generate
LD calculations. This can be done through the
<code>genetics.binaRies</code> package as with bcftools</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_plink.html">set_plink</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Path not provided, using binaries in the MRCIEU/genetics.binaRies package</span></span></code></pre></div>
<p>The rs4442317 variant is not present in the vcf file, i.e. if we
query that variant:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span><span class="op">(</span><span class="va">vcffile</span>, rsid<span class="op">=</span><span class="st">"rs4442317"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="va">nrow</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span><span class="op">(</span><span class="va">vcffile</span>, rsid<span class="op">=</span><span class="st">"rs4442317"</span>, proxies<span class="op">=</span><span class="st">"yes"</span>, bfile<span class="op">=</span><span class="va">ldfile</span>, tag_r2<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; Initial search...</span></span>
<span><span class="co">#&gt; Extracted 0 out of 1 rsids</span></span>
<span><span class="co">#&gt; Searching for proxies for 1 rsids</span></span>
<span><span class="co">#&gt; Determining searchspace...</span></span>
<span><span class="co">#&gt; Proxy lookup...</span></span>
<span><span class="co">#&gt; Finding proxies...</span></span>
<span><span class="co">#&gt; Found 10 proxies</span></span>
<span><span class="co">#&gt; Extrating proxies...</span></span>
<span><span class="co">#&gt; Identified proxies for 1 of 1 rsids</span></span>
<span><span class="co">#&gt; Aligning...</span></span>
<span><span class="va">vcf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/vcf_to_granges.html">vcf_to_granges</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; GRanges object with 1 range and 15 metadata columns:</span></span>
<span><span class="co">#&gt;             seqnames    ranges strand |         REF         ALT      QUAL</span></span>
<span><span class="co">#&gt;                &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt; &lt;character&gt; &lt;numeric&gt;</span></span>
<span><span class="co">#&gt;   rs4442317        1   1106784      * |           T           C        NA</span></span>
<span><span class="co">#&gt;                  FILTER        ES        SE        LP        AF        SS        EZ</span></span>
<span><span class="co">#&gt;             &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;</span></span>
<span><span class="co">#&gt;   rs4442317        PASS    0.0059    0.0071  0.391474    0.8559    138001        NA</span></span>
<span><span class="co">#&gt;                    SI        NC          ID          PR          id</span></span>
<span><span class="co">#&gt;             &lt;numeric&gt; &lt;numeric&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt;</span></span>
<span><span class="co">#&gt;   rs4442317        NA        NA   rs4970420   rs4970420     IEU-a-2</span></span>
<span><span class="co">#&gt;   -------</span></span>
<span><span class="co">#&gt;   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span></span></code></pre></div>
<p>Here we see that the proxy variant is rs4970420.</p>
<p>You may also extract only the best available proxies even if the
requested rsids are present, by using <code>proxies="only"</code>. An
example of this shows that the effect size estimates for the proxy
variants are aligned to the effect alleles of the target variants:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read vcf</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/readVcf-methods.html" class="external-link">readVcf</a></span><span class="op">(</span><span class="va">vcffile</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Obtain the best LD proxy for each of the rsids</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span><span class="op">(</span><span class="va">vcffile</span>, rsid<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span>, proxies<span class="op">=</span><span class="st">"only"</span>, bfile<span class="op">=</span><span class="va">ldfile</span>, tag_r2<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="co">#&gt; Determining searchspace...</span></span>
<span><span class="co">#&gt; Proxy lookup...</span></span>
<span><span class="co">#&gt; Finding proxies...</span></span>
<span><span class="co">#&gt; Found 270 proxies</span></span>
<span><span class="co">#&gt; Extrating proxies...</span></span>
<span><span class="co">#&gt; Identified proxies for 52 of 1 rsids</span></span>
<span><span class="co">#&gt; Aligning...</span></span>
<span></span>
<span><span class="co"># Match the target data to the proxy data</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the target data effects against the proxy data effects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/vcf_to_granges.html">vcf_to_granges</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">$</span><span class="va">ES</span>, <span class="fu"><a href="../reference/vcf_to_granges.html">vcf_to_granges</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">$</span><span class="va">ES</span><span class="op">[</span><span class="va">index</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/target-effects-plot-1.png" alt="Plot of the target data effects against the proxy data effects"><p class="caption">
Plot the target data effects against the proxy data effects
</p>
</div>
</div>
<div class="section level3">
<h3 id="compiling-a-list-of-tagging-variants">Compiling a list of tagging variants<a class="anchor" aria-label="anchor" href="#compiling-a-list-of-tagging-variants"></a>
</h3>
<p>Using the LD reference panel described above, it is possible to
create a sqlite tag reference panel using the following commands. First
get an example LD reference panel:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ldfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"eur.bed"</span>, package<span class="op">=</span><span class="st">"gwasvcf"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".bed"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span></span></code></pre></div>
<p>We also need to provide a path to the plink binary used to generate
LD calculations. This can be done through the
<code>genetics.binaRies</code> package as with bcftools</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_plink.html">set_plink</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Path not provided, using binaries in the MRCIEU/genetics.binaRies package</span></span></code></pre></div>
<p>Now generate the tagging database</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dbfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/create_ldref_sqlite.html">create_ldref_sqlite</a></span><span class="op">(</span><span class="va">ldfile</span>, <span class="va">dbfile</span>, tag_r2 <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; identifying indels to remove</span></span>
<span><span class="co">#&gt; calculating ld tags</span></span>
<span><span class="co">#&gt; formatting</span></span>
<span><span class="co">#&gt; creating sqlite db</span></span></code></pre></div>
<p>Perform the query</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gwas.html">query_gwas</a></span><span class="op">(</span><span class="va">vcffile</span>, rsid<span class="op">=</span><span class="st">"rs4442317"</span>, proxies<span class="op">=</span><span class="st">"yes"</span>, dbfile<span class="op">=</span><span class="va">dbfile</span>, tag_r2<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="co">#&gt; Initial search...</span></span>
<span><span class="co">#&gt; Extracted 0 out of 1 rsids</span></span>
<span><span class="co">#&gt; Searching for proxies for 1 rsids</span></span>
<span><span class="co">#&gt; Proxy lookup...</span></span>
<span><span class="co">#&gt; Found 168 proxies</span></span>
<span><span class="co">#&gt; Extrating proxies...</span></span>
<span><span class="co">#&gt; Identified proxies for 1 of 1 rsids</span></span>
<span><span class="co">#&gt; Aligning...</span></span>
<span><span class="va">vcf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/vcf_to_granges.html">vcf_to_granges</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; GRanges object with 1 range and 15 metadata columns:</span></span>
<span><span class="co">#&gt;             seqnames    ranges strand |         REF         ALT      QUAL</span></span>
<span><span class="co">#&gt;                &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;character&gt; &lt;character&gt; &lt;numeric&gt;</span></span>
<span><span class="co">#&gt;   rs4442317        1   1106784      * |           T           C        NA</span></span>
<span><span class="co">#&gt;                  FILTER        ES        SE        LP        AF        SS        EZ</span></span>
<span><span class="co">#&gt;             &lt;character&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;</span></span>
<span><span class="co">#&gt;   rs4442317        PASS    -4e-04    0.0066 0.0214999       0.9    233073        NA</span></span>
<span><span class="co">#&gt;                    SI        NC          ID          PR          id</span></span>
<span><span class="co">#&gt;             &lt;numeric&gt; &lt;numeric&gt; &lt;character&gt; &lt;character&gt; &lt;character&gt;</span></span>
<span><span class="co">#&gt;   rs4442317        NA        NA  rs10907175  rs10907175     IEU-a-2</span></span>
<span><span class="co">#&gt;   -------</span></span>
<span><span class="co">#&gt;   seqinfo: 1 sequence from an unspecified genome; no seqlengths</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="creating-the-vcf-object-from-a-data-frame">Creating the VCF object from a data frame<a class="anchor" aria-label="anchor" href="#creating-the-vcf-object-from-a-data-frame"></a>
</h2>
<p>If you have GWAS summary data in a text file or data frame, this can
be converted to a VCF object.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/readVcf-methods.html" class="external-link">readVcf</a></span><span class="op">(</span><span class="va">vcffile</span><span class="op">)</span></span>
<span><span class="va">vv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcf_to_granges.html">vcf_to_granges</a></span><span class="op">(</span><span class="va">vcf</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">vv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/exposition.html" class="external-link">%$%</a></span> <span class="fu"><a href="../reference/create_vcf.html">create_vcf</a></span><span class="op">(</span>chrom<span class="op">=</span><span class="va">seqnames</span>, pos<span class="op">=</span><span class="va">start</span>, nea<span class="op">=</span><span class="va">REF</span>, ea<span class="op">=</span><span class="va">ALT</span>, snp<span class="op">=</span><span class="va">ID</span>, ea_af<span class="op">=</span><span class="va">AF</span>, effect<span class="op">=</span><span class="va">ES</span>, se<span class="op">=</span><span class="va">SE</span>, pval<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="va">LP</span>, n<span class="op">=</span><span class="va">SS</span>, name<span class="op">=</span><span class="st">"a"</span><span class="op">)</span></span>
<span><span class="va">out</span></span>
<span><span class="co">#&gt; class: CollapsedVCF </span></span>
<span><span class="co">#&gt; dim: 92 1 </span></span>
<span><span class="co">#&gt; rowRanges(vcf):</span></span>
<span><span class="co">#&gt;   GRanges with 4 metadata columns: REF, ALT, QUAL, FILTER</span></span>
<span><span class="co">#&gt; info(vcf):</span></span>
<span><span class="co">#&gt;   DataFrame with 0 columns: </span></span>
<span><span class="co">#&gt; geno(vcf):</span></span>
<span><span class="co">#&gt;   List of length 6: AF, ES, SE, LP, SS, ID</span></span>
<span><span class="co">#&gt; geno(header(vcf)):</span></span>
<span><span class="co">#&gt;       Number Type   Description                                            </span></span>
<span><span class="co">#&gt;    AF A      Float  Alternate allele frequency in the association study    </span></span>
<span><span class="co">#&gt;    ES A      Float  Effect size estimate relative to the alternative allele</span></span>
<span><span class="co">#&gt;    SE A      Float  Standard error of effect size estimate                 </span></span>
<span><span class="co">#&gt;    LP A      Float  -log10 p-value for effect estimate                     </span></span>
<span><span class="co">#&gt;    SS A      Float  Sample size used to estimate genetic effect            </span></span>
<span><span class="co">#&gt;    ID A      String Study variant identifier</span></span></code></pre></div>
<p>It’s possible to write the vcf file:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/writeVcf-methods.html" class="external-link">writeVcf</a></span><span class="op">(</span><span class="va">out</span>, file<span class="op">=</span><span class="st">"temp.vcf"</span><span class="op">)</span></span></code></pre></div>
<p>You may want to first harmonise the data so that all the non-effect
alleles are aligned to the human genome reference. See the <a href="https://github.com/MRCIEU/gwasglue" class="external-link">gwasglue</a> package on some
functions to do this.</p>
</div>
<div class="section level2">
<h2 id="creating-a-gwasglue2-summaryset-object-from-a-vcf-file">Creating a gwasglue2 SummarySet object from a vcf file<a class="anchor" aria-label="anchor" href="#creating-a-gwasglue2-summaryset-object-from-a-vcf-file"></a>
</h2>
<p>Although still under development, if compared with its predecessor,
the <a href="https://mrcieu.github.io/gwasglue2/" class="external-link">gwasglue2</a> package
has several new features, including the use of S4 R objects.</p>
<p>It is possible to create a <code>SummarySet</code> object from a
GWAS-VCF file or VCF object e.g. output from
<code><a href="https://rdrr.io/pkg/VariantAnnotation/man/readVcf-methods.html" class="external-link">VariantAnnotation::readVcf()</a></code>, <code><a href="../reference/create_vcf.html">create_vcf()</a></code> or
<code><a href="../reference/query_gwas.html">query_gwas()</a></code> using the <code><a href="../reference/gwasvcf_to_summaryset.html">gwasvcf_to_summaryset()</a></code>
function.</p>
<p>For example:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summaryset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VariantAnnotation/man/readVcf-methods.html" class="external-link">readVcf</a></span><span class="op">(</span><span class="va">vcffile</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>              <span class="fu"><a href="../reference/gwasvcf_to_summaryset.html">gwasvcf_to_summaryset</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Once the <code>SummarySet</code> objects are created, it is possible
to use <code>gwasglue2</code> to harmonise data, harmonise against a LD
matrix, remap genomic coordinates to a different genome assembly,
convert to other formats and more.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gibran Hemani.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
